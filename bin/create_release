#!/usr/bin/env php
<?php

require __DIR__.'/../vendor/autoload.php';

use SymfonyDocsBuilder\Phar\Compiler;
use SymfonyDocsBuilder\Release\GithubApiHttpClientFactory;
use SymfonyDocsBuilder\Release\Releaser;

error_reporting(-1);
ini_set('display_errors', 1);

try {
    $releaser = new Releaser((new GithubApiHttpClientFactory())->createHttpClient(), new Compiler());

    if ($argc === 1) {
        throw new RuntimeException('Not enough arguments. usage: "./bin/release tag [release_name [release_description]]"');
    }

    array_shift($argv);

    $releaser->createRelease(...$argv);
} catch (Exception $e) {
    echo 'Failed to create a new release: ['.get_class($e).'] '.$e->getMessage().' at '.$e->getFile().':'.$e->getLine()."\n";
    exit(1);
}
